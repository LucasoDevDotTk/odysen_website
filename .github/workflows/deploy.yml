name: deploy production
on:
    push:
        branches: [ "main" ]

    workflow_dispatch:

defaults:
    run:
        shell: bash
        working-directory: infra_website
    

jobs:
    pull:
        name: pull
        runs-on: self-hosted
        steps:
            - name: pull
              run: git pull --rebase
    image:
        name: image
        runs-on: self-hosted
        steps:
            - name: build
              run: docker build -t ${{ github.job }} .
    deploy:
        needs: image
        name: deploy
        runs-on: self-hosted
        steps:
            - name: cleanup
              run: docker rm -f ${{ github.job }}
            - name: run-image
              run: docker run $PORT $ENV --name ${{ github.job }} -d ${{ github.job }}